# 프로세스와 스레드

- 프로세스 : 컴퓨터에서 실행되는 프로그램 CPU 스케줄링 대상이 되는 작업(task)
- 스레드 : 프로세스 내 작업의 흐름
- 프로그램 : 어떤 작업을 하기 위해 해야할 일들을 순서대로 나열한 것

### 프로그램

- 사용자가 원하는 일을 처리할 수 있도록 프로그래밍 언어를 사용하여 올바른 수행절차를 표현해 놓은 명령어들의 집합
- 필요한 데이터를 묶어 놓은 파일로 보조 기억장치에 저장됨
- 컴퓨터에서 어떠한 작업을 위해 실행할 수 있는 "정적인 상태"의 파일

### 프로세스

- 컴퓨터에서 연속적으로 실행되고 있는 "동적인 상태"의 프로그램
- 운영체제가 메모리 등의 필요한 자원에 할당해준 "실행중인 프로그램"
- 프로그램 실행 => 자원을 할당받아 프로세스

![Process](image.png)

- Code, Data, Stack, Heap의 구조로 이루어진 독립된 메모리 영역을 할당
- 각 프로세스는 별도의 주소 공간에서 실행되며, 서로 독자적인 메모리 공간을 가짐
- 다른 프로세스 자원에 접근하기 위해서는 프로세스간 통신(IPC)을 사용해야 한다.
- 최소 하나 이상의 스레드를 포함한다.

### 스레드

- 프로세스가 할당받은 자원을 이용하는 실행단위
- 프로세스 내에서 실행되는 여러 흐름의 단위
- 프로세스 자원을 이용해서 실제로 작업을 수행하는 일꾼
- 프로세스가 할당받은 자원을 스레드가 사용하며 프로세스는 최소 한 개 이상의 스레드를 가지고 이 스레드를 메인 스레드라고 한다.

![Thread](image-1.png)

- 독자적인 스택 메모리를 가짐
- 프로세스 내에서 각각 스택만 할당받고 Code, Data, Heap 영역을 공유한다.
- 여러 실행의 흐름으로, 프로세스 내의 주소공간이나 자원들을 같은 프로세스 내의 스레드끼리 공유하며 실행된다.
- 한 스레드가 프로세스 자원을 변경 할 경우 다른 스레드도 그 변경 결과를 알 수 있다. ( 프로세스 내의 자원이 변경되기 때문에 접근 가능 )

| 차이점        | 프로세스          | 스레드                    |
| ------------- | ----------------- | ------------------------- |
| 정의          | 실행중인 프로그램 | 프로세스의 실행단위       |
| 생성/종료시간 | 많은 시간 소요    | 적은 시간 소요            |
| 컨텍스트 전환 | 많은 시간 소요    | 적은 시간 소요            |
| 상호작용      | IPC 사용          | 공유 메모리 사용          |
| 자원 소모     | 많음              | 적음                      |
| 독립성        | 각각 독립적       | 스택만 독립적 외에는 공유 |

## 3.3.1 프로세스와 컴파일 과정

![compile flow](image-2.png)

#### 전처리

- 소스 코드 주석제거, 헤더 파일을 병합하여 매크로로 치환

#### 컴파일러

- 오류 처리, 코드 최적화 작업을 하여 어셈블리어로 변환

#### 어셈블러

- 목적 코드(object code)로 변환됩니다.

#### 링커

- 프로그램 내의 라이브러리 함수 or 다른 파일들과 목적 코드를 결합하여 .exe 파일로 만듬

### 정적라이브러리

- 장점

  - 컴파일 시 필요한 라이브러리 프로그램 내에 가지고 있기 때문에 이식성이 좋다.
  - 런타임 시 외부를 참조할 필요가 없어 속도가 빠름

- 단점
  - 라이브러리를 가지고 있는 만큼 프로그램의 크기가 커집니다.
  - 라이브러리를 가진 여러 프로그램을 실행할 경우 코드가 중복되어 메모리를 낭비
  - 라이브러리 변경이 필요할 때, 변경된 라이브러리만 재배포 하는 것이 아닌 프로그램을 다시 재배포

### 동적라이브러리

- 라이브러리를 복사하지 않고 해당 내용의 주소만 가지고 있다가, 실행 파일에서 라이브러리 기능을 사용할 때 주소를 통해 필요한 내용을 가져오는 방식
- \*.lib, \*.dll 파일

  - lib : 파일을 링크할 때 필요
  - dll : 파일을 실행할 때 필요 ( Windows 운영체제에서만 사용 )

- 장점

  - 정적 라이브러리와 비교했을 때 실행 파일에 라이브러리를 포함하지 않기 때문에 실행 파일 크기가 작아진다.
  - 여러 프로그램이 하나의 메모리에 있는 동적 라이브러리를 공유하여 사용할 수 있기 때문에 메모리 자원을 효율적으로 사용할 수 있다.
  - 라이브러리에서 수정할 부분이 있다면 실행 파일을 새로 컴파일할 필요 없이 동적 라이브러리만 다시 컴파일하여 재배포 가능하다.
  - 언어 형식이 다른 여러 프로그램을 지원하고, 함수의 호출 규칙만 준수하면 다른 언어로 작성된 여러 프로그램에서 동일한 동적 라이브러리 함수를 호출할 수 있다.

- 단점

  - 실행파일은 동적 라이브러리가 필요하기 때문에 외부 의존도가 생겨서 이식성이 낮음
  - 프로그램 영역에서 라이브러리가 저장된 주소로 이동하는 과정이 필요하고 성능 저하가 발생

## 3.3.2 프로세스의 상태

![Process State](image-3.png)

### 생성 상태

- 프로그램이 커널 영역에서 PCB(Process Control Block)를 부여받은 상태 => PCB : 특정한 프로세스를 관리할 필요가 있는 정보를 포함하는, 운영체제 커널의 자료구조
- 주 기억장치 공간이 여유로운지 체크 후, 공간이 충분하면 프로세스 주소 공간을 할당한 후 프로세스를 준비 상태로 바꿈

### 대기 상태

-
